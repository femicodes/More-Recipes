'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.verifyUserSession = undefined;

var _jsonwebtoken = require('jsonwebtoken');

var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var verifyUserSession = exports.verifyUserSession = function verifyUserSession(req, res, next) {
	var token = req.body.token || req.headers.token || req.query.token;
	// console.log(token);
	// if no token --> 
	if (!token) {
		return res.status(500).json({ success: false, message: 'Token is required!' });
	} else {

		// Check if token matches the one provided at login
		_jsonwebtoken2.default.verify(token, process.env.SECRET_KEY, function (err, decoded) {
			if (err) {
				if (err.message === 'TokenExpiredError') return res.status(500).json({ success: false, message: 'Session has expired, Please sign-in again' });

				return res.status(500).json({ success: false, message: 'Failed to authenticate token' });
			}

			// if no error at all
			req.userId = decoded.user.id;
			next();
		});
	}
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6ZS5qcyJdLCJuYW1lcyI6WyJ2ZXJpZnlVc2VyU2Vzc2lvbiIsInJlcSIsInJlcyIsIm5leHQiLCJ0b2tlbiIsImJvZHkiLCJoZWFkZXJzIiwicXVlcnkiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiU0VDUkVUX0tFWSIsImVyciIsImRlY29kZWQiLCJ1c2VySWQiLCJ1c2VyIiwiaWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7Ozs7O0FBRU8sSUFBTUEsZ0RBQW9CLFNBQXBCQSxpQkFBb0IsQ0FBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQVdDLElBQVgsRUFBb0I7QUFDcEQsS0FBTUMsUUFBUUgsSUFBSUksSUFBSixDQUFTRCxLQUFULElBQWtCSCxJQUFJSyxPQUFKLENBQVlGLEtBQTlCLElBQXVDSCxJQUFJTSxLQUFKLENBQVVILEtBQS9EO0FBQ0E7QUFDQTtBQUNBLEtBQUssQ0FBQ0EsS0FBTixFQUFjO0FBQ2IsU0FBT0YsSUFBSU0sTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLEVBQUNDLFNBQVMsS0FBVixFQUFpQkMsU0FBUyxvQkFBMUIsRUFBckIsQ0FBUDtBQUNBLEVBRkQsTUFFTzs7QUFFTjtBQUNBLHlCQUFJQyxNQUFKLENBQVdSLEtBQVgsRUFBa0JTLFFBQVFDLEdBQVIsQ0FBWUMsVUFBOUIsRUFBMEMsVUFBQ0MsR0FBRCxFQUFNQyxPQUFOLEVBQWtCO0FBQzNELE9BQUlELEdBQUosRUFBUztBQUNSLFFBQUlBLElBQUlMLE9BQUosS0FBZ0IsbUJBQXBCLEVBQ0MsT0FBT1QsSUFBSU0sTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLEVBQUNDLFNBQVMsS0FBVixFQUFpQkMsU0FBUywyQ0FBMUIsRUFBckIsQ0FBUDs7QUFFRCxXQUFPVCxJQUFJTSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsRUFBQ0MsU0FBUyxLQUFWLEVBQWlCQyxTQUFTLDhCQUExQixFQUFyQixDQUFQO0FBQ0E7O0FBRUQ7QUFDQVYsT0FBSWlCLE1BQUosR0FBYUQsUUFBUUUsSUFBUixDQUFhQyxFQUExQjtBQUNBakI7QUFDQSxHQVhEO0FBWUE7QUFDRCxDQXRCTSIsImZpbGUiOiJhdXRob3JpemUuanMiLCJzb3VyY2VSb290IjoiQzovVXNlcnMvVG9iaS9Nb3JlLVJlY2lwZXMvc2VydmVyL21pZGRsZXdhcmUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XHJcblxyXG5leHBvcnQgY29uc3QgdmVyaWZ5VXNlclNlc3Npb24gPSAocmVxLCByZXMsIG5leHQpID0+IHtcclxuXHRjb25zdCB0b2tlbiA9IHJlcS5ib2R5LnRva2VuIHx8IHJlcS5oZWFkZXJzLnRva2VuIHx8IHJlcS5xdWVyeS50b2tlbjtcclxuXHQvLyBjb25zb2xlLmxvZyh0b2tlbik7XHJcblx0Ly8gaWYgbm8gdG9rZW4gLS0+IFxyXG5cdGlmICggIXRva2VuICkge1xyXG5cdFx0cmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ1Rva2VuIGlzIHJlcXVpcmVkISd9KTtcclxuXHR9IGVsc2Uge1xyXG4gICAgXHJcblx0XHQvLyBDaGVjayBpZiB0b2tlbiBtYXRjaGVzIHRoZSBvbmUgcHJvdmlkZWQgYXQgbG9naW5cclxuXHRcdGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LlNFQ1JFVF9LRVksIChlcnIsIGRlY29kZWQpID0+IHtcclxuXHRcdFx0aWYgKGVycikge1xyXG5cdFx0XHRcdGlmIChlcnIubWVzc2FnZSA9PT0gJ1Rva2VuRXhwaXJlZEVycm9yJylcclxuXHRcdFx0XHRcdHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7c3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdTZXNzaW9uIGhhcyBleHBpcmVkLCBQbGVhc2Ugc2lnbi1pbiBhZ2Fpbid9KTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRyZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe3N1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB0b2tlbid9KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0Ly8gaWYgbm8gZXJyb3IgYXQgYWxsXHJcblx0XHRcdHJlcS51c2VySWQgPSBkZWNvZGVkLnVzZXIuaWQ7XHJcblx0XHRcdG5leHQoKTtcclxuXHRcdH0pO1xyXG5cdH1cclxufTtcclxuIl19