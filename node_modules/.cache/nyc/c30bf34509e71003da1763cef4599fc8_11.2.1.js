'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.getUserRecipes = exports.loginUser = exports.createUser = undefined;

var _models = require('../models');

var _models2 = _interopRequireDefault(_models);

var _bcryptjs = require('bcryptjs');

var _bcryptjs2 = _interopRequireDefault(_bcryptjs);

var _jsonwebtoken = require('jsonwebtoken');

var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var User = _models2.default.User,
    Recipe = _models2.default.Recipe;

// Create users.

var createUser = exports.createUser = function createUser(req, res) {

	var username = req.body.username ? req.body.username.trim() : '';
	var email = req.body.email ? req.body.email.trim() : '';
	var password = req.body.password ? req.body.password.trim() : '';

	var EMAIL_REGEXP = /^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;
	var USERNAME_REGEXP = /^(\w){3,15}$/;

	var err_msg = void 0;
	if (username === '') {
		err_msg = 'Username is required';
	} else if (email === '') {
		err_msg = 'Email is required';
	} else if (!USERNAME_REGEXP.test(username)) {
		err_msg = 'Username must be atleast 3 characters long and alphanumeric';
	} else if (email.length <= 4 || email.length > 30 || !EMAIL_REGEXP.test(email)) {
		err_msg = 'invalid email address';
	} else if (password === '') {
		err_msg = 'Password is required';
	} else if (password.length < 6) {
		err_msg = 'Password must be atleast 6 characters long!';
	}

	if (err_msg) return res.status(422).json({ success: false, message: err_msg });

	return User.create({
		username: username,
		email: email,
		password: _bcryptjs2.default.hashSync(password, 10),
		fullname: req.body.fullname
	}).then(function (user) {
		var token = _jsonwebtoken2.default.sign({ user: user }, process.env.SECRET_KEY, { expiresIn: '120m' });
		res.status(201).json({
			success: true,
			message: 'Account created successfully',
			id: user.id,
			username: user.username,
			email: user.email,
			token: token
		});
	}).catch(function (err) {
		return res.status(400).json({
			success: false,
			message: err //.errors[0].message
		});
	});
};

//The username and password you entered did not match our records. Please double-check and try again.

// Sign in users
var loginUser = exports.loginUser = function loginUser(req, res) {
	var username = req.body.username ? req.body.username.trim() : '';
	var password = req.body.password;

	if (!(username && password)) return res.status(400).json({ success: false, message: 'username and password are required' });

	return User.findOne({
		where: {
			username: req.body.username
		}
	}).then(function (user) {
		var token = _jsonwebtoken2.default.sign({ user: user }, process.env.SECRET_KEY, { expiresIn: '120m' });
		_bcryptjs2.default.compare(password, user.password).then(function (check) {
			if (check) {
				// console.log(req.userId); 
				res.status(200).json({
					success: true,
					message: 'Logged in Successfully!',
					token: token
				});
			} else res.status(401).json({
				success: false,
				message: 'Wrong username and password!'
			});
		}).catch(function (err) {
			return res.status(400).json({
				success: false,
				message: err.errors[0].message });
		});
	});
};

var getUserRecipes = exports.getUserRecipes = function getUserRecipes(req, res) {
	var userId = req.params.userId;
	// console.log(userId);

	Recipe.findAll({
		where: {
			userId: userId
		}
	}).then(function (recipes) {
		var recipesCount = recipes.length;
		// console.log(favorites);
		if (recipesCount == 0) {
			return res.status(200).json({
				success: true,
				message: 'User has no recipes posted'
			});
		}
		return res.status(200).json({ success: true, message: recipesCount + ' recipes posted', recipes: recipes });
	}).catch(function () {
		return res.status(500).json({ success: false, message: 'An error occured! ' });
	});
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsiVXNlciIsIlJlY2lwZSIsImNyZWF0ZVVzZXIiLCJyZXEiLCJyZXMiLCJ1c2VybmFtZSIsImJvZHkiLCJ0cmltIiwiZW1haWwiLCJwYXNzd29yZCIsIkVNQUlMX1JFR0VYUCIsIlVTRVJOQU1FX1JFR0VYUCIsImVycl9tc2ciLCJ0ZXN0IiwibGVuZ3RoIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiY3JlYXRlIiwiaGFzaFN5bmMiLCJmdWxsbmFtZSIsInRoZW4iLCJ0b2tlbiIsInNpZ24iLCJ1c2VyIiwicHJvY2VzcyIsImVudiIsIlNFQ1JFVF9LRVkiLCJleHBpcmVzSW4iLCJpZCIsImNhdGNoIiwiZXJyIiwibG9naW5Vc2VyIiwiZmluZE9uZSIsIndoZXJlIiwiY29tcGFyZSIsImNoZWNrIiwiZXJyb3JzIiwiZ2V0VXNlclJlY2lwZXMiLCJ1c2VySWQiLCJwYXJhbXMiLCJmaW5kQWxsIiwicmVjaXBlc0NvdW50IiwicmVjaXBlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0lBRVFBLEksb0JBQUFBLEk7SUFBTUMsTSxvQkFBQUEsTTs7QUFFZDs7QUFDTyxJQUFNQyxrQ0FBYSxTQUFiQSxVQUFhLENBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFjOztBQUV2QyxLQUFJQyxXQUFXRixJQUFJRyxJQUFKLENBQVNELFFBQVQsR0FBbUJGLElBQUlHLElBQUosQ0FBU0QsUUFBVCxDQUFrQkUsSUFBbEIsRUFBbkIsR0FBNkMsRUFBNUQ7QUFDQSxLQUFJQyxRQUFRTCxJQUFJRyxJQUFKLENBQVNFLEtBQVQsR0FBZ0JMLElBQUlHLElBQUosQ0FBU0UsS0FBVCxDQUFlRCxJQUFmLEVBQWhCLEdBQXVDLEVBQW5EO0FBQ0EsS0FBSUUsV0FBV04sSUFBSUcsSUFBSixDQUFTRyxRQUFULEdBQW9CTixJQUFJRyxJQUFKLENBQVNHLFFBQVQsQ0FBa0JGLElBQWxCLEVBQXBCLEdB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QUFQO0FBSUE7QUFDRCxTQUFPZCxJQUFJVyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsRUFBQ0MsU0FBUyxJQUFWLEVBQWdCQyxTQUFZeUIsWUFBWixvQkFBaEIsRUFBMkRDLGdCQUEzRCxFQUFyQixDQUFQO0FBQ0EsRUFoQkYsRUFpQkViLEtBakJGLENBaUJTO0FBQUEsU0FBTTNCLElBQUlXLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQixFQUFDQyxTQUFTLEtBQVYsRUFBaUJDLFNBQVMsb0JBQTFCLEVBQXJCLENBQU47QUFBQSxFQWpCVDtBQWtCQSxDQXJCTSIsImZpbGUiOiJ1c2VyLmpzIiwic291cmNlUm9vdCI6IkM6L1VzZXJzL1RvYmkvTW9yZS1SZWNpcGVzL3NlcnZlci9jb250cm9sbGVyIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRiIGZyb20gJy4uL21vZGVscyc7XHJcbmltcG9ydCBiY3J5cHRqcyBmcm9tICdiY3J5cHRqcyc7XHJcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcclxuXHJcbmNvbnN0IHsgVXNlciwgUmVjaXBlIH0gPSBkYjtcclxuXHJcbi8vIENyZWF0ZSB1c2Vycy5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZVVzZXIgPSAocmVxLCByZXMpID0+IHtcclxuXHJcblx0bGV0IHVzZXJuYW1lID0gcmVxLmJvZHkudXNlcm5hbWU/IHJlcS5ib2R5LnVzZXJuYW1lLnRyaW0oKTogJyc7IFxyXG5cdGxldCBlbWFpbCA9IHJlcS5ib2R5LmVtYWlsPyByZXEuYm9keS5lbWFpbC50cmltKCk6ICcnO1xyXG5cdGxldCBwYXNzd29yZCA9IHJlcS5ib2R5LnBhc3N3b3JkID8gcmVxLmJvZHkucGFzc3dvcmQudHJpbSgpOiAnJztcclxuXHJcblx0Y29uc3QgRU1BSUxfUkVHRVhQID0gL14oXFx3KSsoXFwuXFx3KykqQChcXHcpKygoXFwuXFx3KykrKSQvO1xyXG5cdGNvbnN0IFVTRVJOQU1FX1JFR0VYUCA9IC9eKFxcdyl7MywxNX0kLztcclxuXHJcblx0bGV0IGVycl9tc2c7XHJcblx0aWYgKHVzZXJuYW1lID09PSAnJyl7XHJcblx0XHRlcnJfbXNnID0gJ1VzZXJuYW1lIGlzIHJlcXVpcmVkJztcclxuXHR9IGVsc2UgaWYgKGVtYWlsID09PSAnJykge1xyXG5cdFx0ZXJyX21zZyA9ICdFbWFpbCBpcyByZXF1aXJlZCc7XHJcblx0fSBlbHNlIGlmICggIVVTRVJOQU1FX1JFR0VYUC50ZXN0KHVzZXJuYW1lKSApIHtcclxuXHRcdGVycl9tc2cgPSAnVXNlcm5hbWUgbXVzdCBiZSBhdGxlYXN0IDMgY2hhcmFjdGVycyBsb25nIGFuZCBhbHBoYW51bWVyaWMnO1xyXG5cdH0gZWxzZSBpZiAoZW1haWwubGVuZ3RoIDw9IDQgfHwgZW1haWwubGVuZ3RoID4gMzAgfHwgIUVNQUlMX1JFR0VYUC50ZXN0KGVtYWlsKSkge1xyXG5cdFx0ZXJyX21zZyA9J2ludmFsaWQgZW1haWwgYWRkcmVzcyc7XHJcblx0fSBlbHNlIGlmIChwYXNzd29yZCA9PT0gJycpIHtcclxuXHRcdGVycl9tc2cgPSAnUGFzc3dvcmQgaXMgcmVxdWlyZWQnO1xyXG5cdH0gZWxzZSBpZiAocGFzc3dvcmQubGVuZ3RoIDwgNikge1xyXG5cdFx0ZXJyX21zZyA9ICdQYXNzd29yZCBtdXN0IGJlIGF0bGVhc3QgNiBjaGFyYWN0ZXJzIGxvbmchJztcclxuXHR9XHJcblxyXG5cdGlmIChlcnJfbXNnKSBcclxuXHRcdHJldHVybiByZXMuc3RhdHVzKDQyMikuanNvbih7c3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycl9tc2d9KTtcclxuXHJcblx0cmV0dXJuIFVzZXJcclxuXHRcdC5jcmVhdGUoe1xyXG5cdFx0XHR1c2VybmFtZTogdXNlcm5hbWUsXHJcblx0XHRcdGVtYWlsOiBlbWFpbCxcclxuXHRcdFx0cGFzc3dvcmQ6IGJjcnlwdGpzLmhhc2hTeW5jKHBhc3N3b3JkLCAxMCksXHJcblx0XHRcdGZ1bGxuYW1lOiByZXEuYm9keS5mdWxsbmFtZVxyXG5cdFx0fSlcclxuXHRcdC50aGVuKHVzZXIgPT4ge1xyXG5cdFx0XHRjb25zdCB0b2tlbiA9IGp3dC5zaWduKHt1c2VyfSwgcHJvY2Vzcy5lbnYuU0VDUkVUX0tFWSwgeyBleHBpcmVzSW46ICcxMjBtJ30pO1xyXG5cdFx0XHRyZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcblx0XHRcdFx0c3VjY2VzczogdHJ1ZSxcclxuXHRcdFx0XHRtZXNzYWdlOiAnQWNjb3VudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXHJcblx0XHRcdFx0aWQ6IHVzZXIuaWQsXHJcblx0XHRcdFx0dXNlcm5hbWU6IHVzZXIudXNlcm5hbWUsXHJcblx0XHRcdFx0ZW1haWw6IHVzZXIuZW1haWwsXHJcblx0XHRcdFx0dG9rZW5cclxuXHRcdFx0fSk7XHJcblx0XHR9KVxyXG5cdFx0LmNhdGNoKGVyciA9PiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcblx0XHRcdHN1Y2Nlc3M6IGZhbHNlLFxyXG5cdFx0XHRtZXNzYWdlOiBlcnIgLy8uZXJyb3JzWzBdLm1lc3NhZ2VcclxuXHRcdH0pKTtcclxufTtcclxuXHJcblxyXG4vL1RoZSB1c2VybmFtZSBhbmQgcGFzc3dvcmQgeW91IGVudGVyZWQgZGlkIG5vdCBtYXRjaCBvdXIgcmVjb3Jkcy4gUGxlYXNlIGRvdWJsZS1jaGVjayBhbmQgdHJ5IGFnYWluLlxyXG5cclxuLy8gU2lnbiBpbiB1c2Vyc1xyXG5leHBvcnQgY29uc3QgbG9naW5Vc2VyID0gKHJlcSwgcmVzKSA9PiB7XHJcblx0bGV0IHVzZXJuYW1lID0gcmVxLmJvZHkudXNlcm5hbWU/IHJlcS5ib2R5LnVzZXJuYW1lLnRyaW0oKTogJyc7IFxyXG5cdGxldCBwYXNzd29yZCA9IHJlcS5ib2R5LnBhc3N3b3JkO1xyXG5cdFxyXG5cdGlmICggISh1c2VybmFtZSAmJiBwYXNzd29yZCkgKSBcclxuXHRcdHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7c3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6J3VzZXJuYW1lIGFuZCBwYXNzd29yZCBhcmUgcmVxdWlyZWQnfSk7XHJcblxyXG5cdHJldHVybiBVc2VyXHJcblx0XHQuZmluZE9uZSh7XHJcblx0XHRcdHdoZXJlOiB7IFxyXG5cdFx0XHRcdHVzZXJuYW1lOiByZXEuYm9keS51c2VybmFtZSxcclxuXHRcdFx0fVxyXG5cdFx0fSlcclxuXHRcdC50aGVuKCB1c2VyID0+IHsgXHJcblx0XHRcdGNvbnN0IHRva2VuID0gand0LnNpZ24oe3VzZXJ9LCBwcm9jZXNzLmVudi5TRUNSRVRfS0VZLCB7IGV4cGlyZXNJbjogJzEyMG0nfSk7XHJcblx0XHRcdGJjcnlwdGpzLmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpLnRoZW4oIGNoZWNrID0+IHtcclxuXHRcdFx0XHRpZiAoY2hlY2spIHtcclxuXHRcdFx0XHRcdC8vIGNvbnNvbGUubG9nKHJlcS51c2VySWQpOyBcclxuXHRcdFx0XHRcdHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuXHRcdFx0XHRcdFx0c3VjY2VzczogdHJ1ZSxcclxuXHRcdFx0XHRcdFx0bWVzc2FnZTogJ0xvZ2dlZCBpbiBTdWNjZXNzZnVsbHkhJyxcclxuXHRcdFx0XHRcdFx0dG9rZW5cclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH0gZWxzZSByZXMuc3RhdHVzKDQwMSkuanNvbih7XHJcblx0XHRcdFx0XHRzdWNjZXNzOiBmYWxzZSxcclxuXHRcdFx0XHRcdG1lc3NhZ2U6ICdXcm9uZyB1c2VybmFtZSBhbmQgcGFzc3dvcmQhJ1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9KS5jYXRjaChlcnIgPT4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG5cdFx0XHRcdHN1Y2Nlc3M6IGZhbHNlLFxyXG5cdFx0XHRcdG1lc3NhZ2U6IGVyci5lcnJvcnNbMF0ubWVzc2FnZX0pKTtcclxuXHRcdH0pO1xyXG59O1xyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBnZXRVc2VyUmVjaXBlcyA9IChyZXEsIHJlcykgPT4ge1xyXG5cdGNvbnN0IHsgdXNlcklkIH0gPSByZXEucGFyYW1zO1xyXG5cdC8vIGNvbnNvbGUubG9nKHVzZXJJZCk7XHJcblx0UmVjaXBlXHJcblx0XHQuZmluZEFsbCh7XHJcblx0XHRcdHdoZXJlOiB7XHJcblx0XHRcdFx0dXNlcklkXHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblx0XHQudGhlbiggcmVjaXBlcyA9PiB7XHJcblx0XHRcdGNvbnN0IHJlY2lwZXNDb3VudCA9ICByZWNpcGVzLmxlbmd0aDtcclxuXHRcdFx0Ly8gY29uc29sZS5sb2coZmF2b3JpdGVzKTtcclxuXHRcdFx0aWYgKCByZWNpcGVzQ291bnQgPT0gMCApIHtcclxuXHRcdFx0XHRyZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG5cdFx0XHRcdFx0c3VjY2Vzczp0cnVlLFxyXG5cdFx0XHRcdFx0bWVzc2FnZTogJ1VzZXIgaGFzIG5vIHJlY2lwZXMgcG9zdGVkJyxcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe3N1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6IGAke3JlY2lwZXNDb3VudH0gcmVjaXBlcyBwb3N0ZWRgLCByZWNpcGVzfSk7IFxyXG5cdFx0fSlcclxuXHRcdC5jYXRjaCggKCkgPT4gcmVzLnN0YXR1cyg1MDApLmpzb24oe3N1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnQW4gZXJyb3Igb2NjdXJlZCEgJ30pKTtcclxufTsiXX0=