'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.verifyUserSession = undefined;

var _jsonwebtoken = require('jsonwebtoken');

var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var verifyUserSession = exports.verifyUserSession = function verifyUserSession(req, res, next) {
	var token = req.body.token || req.headers.token || req.query.token;
	// if no token found --> 
	if (!token) {
		return res.status(401).json({ success: false, message: 'An authorization token is required!' });
	} else {

		// Check if token matches the one provided at login
		_jsonwebtoken2.default.verify(token, process.env.SECRET_KEY, function (err, decoded) {
			if (err) {
				if (err.name === 'TokenExpiredError') return res.status(401).json({ success: false, message: 'Session has expired, Please sign-in again' });

				return res.status(401).json({ success: false, message: 'Failed to authenticate token' });
			}

			// if no error at all
			req.userId = decoded.user.id;
			next();
		});
	}
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6ZS5qcyJdLCJuYW1lcyI6WyJ2ZXJpZnlVc2VyU2Vzc2lvbiIsInJlcSIsInJlcyIsIm5leHQiLCJ0b2tlbiIsImJvZHkiLCJoZWFkZXJzIiwicXVlcnkiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiU0VDUkVUX0tFWSIsImVyciIsImRlY29kZWQiLCJuYW1lIiwidXNlcklkIiwidXNlciIsImlkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7OztBQUVPLElBQU1BLGdEQUFvQixTQUFwQkEsaUJBQW9CLENBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFXQyxJQUFYLEVBQW9CO0FBQ3BELEtBQU1DLFFBQVFILElBQUlJLElBQUosQ0FBU0QsS0FBVCxJQUFrQkgsSUFBSUssT0FBSixDQUFZRixLQUE5QixJQUF1Q0gsSUFBSU0sS0FBSixDQUFVSCxLQUEvRDtBQUNBO0FBQ0EsS0FBSyxDQUFDQSxLQUFOLEVBQWM7QUFDYixTQUFPRixJQUFJTSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsRUFBQ0MsU0FBUyxLQUFWLEVBQWlCQyxTQUFTLHFDQUExQixFQUFyQixDQUFQO0FBQ0EsRUFGRCxNQUVPOztBQUVOO0FBQ0EseUJBQUlDLE1BQUosQ0FBV1IsS0FBWCxFQUFrQlMsUUFBUUMsR0FBUixDQUFZQyxVQUE5QixFQUEwQyxVQUFDQyxHQUFELEVBQU1DLE9BQU4sRUFBa0I7QUFDM0QsT0FBSUQsR0FBSixFQUFTO0FBQ1IsUUFBSUEsSUFBSUUsSUFBSixLQUFhLG1CQUFqQixFQUNDLE9BQU9oQixJQUFJTSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsRUFBQ0MsU0FBUyxLQUFWLEVBQWlCQyxTQUFTLDJDQUExQixFQUFyQixDQUFQOztBQUVELFdBQU9ULElBQUlNLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQixFQUFDQyxTQUFTLEtBQVYsRUFBaUJDLFNBQVMsOEJBQTFCLEVBQXJCLENBQVA7QUFDQTs7QUFFRDtBQUNBVixPQUFJa0IsTUFBSixHQUFhRixRQUFRRyxJQUFSLENBQWFDLEVBQTFCO0FBQ0FsQjtBQUNBLEdBWEQ7QUFZQTtBQUNELENBckJNIiwiZmlsZSI6ImF1dGhvcml6ZS5qcyIsInNvdXJjZVJvb3QiOiJDOi9Vc2Vycy9Ub2JpL01vcmUtUmVjaXBlcy9zZXJ2ZXIvbWlkZGxld2FyZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcclxuXHJcbmV4cG9ydCBjb25zdCB2ZXJpZnlVc2VyU2Vzc2lvbiA9IChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG5cdGNvbnN0IHRva2VuID0gcmVxLmJvZHkudG9rZW4gfHwgcmVxLmhlYWRlcnMudG9rZW4gfHwgcmVxLnF1ZXJ5LnRva2VuO1xyXG5cdC8vIGlmIG5vIHRva2VuIGZvdW5kIC0tPiBcclxuXHRpZiAoICF0b2tlbiApIHtcclxuXHRcdHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7c3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdBbiBhdXRob3JpemF0aW9uIHRva2VuIGlzIHJlcXVpcmVkISd9KTtcclxuXHR9IGVsc2Uge1xyXG4gICAgXHJcblx0XHQvLyBDaGVjayBpZiB0b2tlbiBtYXRjaGVzIHRoZSBvbmUgcHJvdmlkZWQgYXQgbG9naW5cclxuXHRcdGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LlNFQ1JFVF9LRVksIChlcnIsIGRlY29kZWQpID0+IHtcclxuXHRcdFx0aWYgKGVycikge1xyXG5cdFx0XHRcdGlmIChlcnIubmFtZSA9PT0gJ1Rva2VuRXhwaXJlZEVycm9yJylcclxuXHRcdFx0XHRcdHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7c3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdTZXNzaW9uIGhhcyBleHBpcmVkLCBQbGVhc2Ugc2lnbi1pbiBhZ2Fpbid9KTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRyZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe3N1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB0b2tlbid9KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0Ly8gaWYgbm8gZXJyb3IgYXQgYWxsXHJcblx0XHRcdHJlcS51c2VySWQgPSBkZWNvZGVkLnVzZXIuaWQ7XHJcblx0XHRcdG5leHQoKTtcclxuXHRcdH0pO1xyXG5cdH1cclxufTtcclxuIl19