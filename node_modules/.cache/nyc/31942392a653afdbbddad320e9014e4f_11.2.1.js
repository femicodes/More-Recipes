'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.getUserRecipes = exports.loginUser = exports.createUser = undefined;

var _models = require('../models');

var _models2 = _interopRequireDefault(_models);

var _bcryptjs = require('bcryptjs');

var _bcryptjs2 = _interopRequireDefault(_bcryptjs);

var _jsonwebtoken = require('jsonwebtoken');

var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var User = _models2.default.User,
    Recipe = _models2.default.Recipe;

// Create users.

var createUser = exports.createUser = function createUser(req, res) {

	var username = req.body.username ? req.body.username.trim() : '';
	var email = req.body.email ? req.body.email.trim() : '';
	var password = req.body.password ? req.body.password.trim() : '';

	var EMAIL_REGEXP = /^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;
	var USERNAME_REGEXP = /^(\w){3,15}$/;

	var err_msg = void 0;
	if (username === '') {
		err_msg = 'Username is required';
	} else if (email === '') {
		err_msg = 'Email is required';
	} else if (!USERNAME_REGEXP.test(username)) {
		err_msg = 'Username must be atleast 3 characters long and alphanumeric';
	} else if (email.length <= 4 || email.length > 30 || !EMAIL_REGEXP.test(email)) {
		err_msg = 'invalid email address';
	} else if (password === '') {
		err_msg = 'Password is required';
	} else if (password.length < 6) {
		err_msg = 'Password must be atleast 6 characters long!';
	}

	if (err_msg) return res.status(422).json({ success: false, message: err_msg });

	return User.create({
		username: username,
		email: email,
		password: _bcryptjs2.default.hashSync(password, 10),
		fullname: req.body.fullname
	}).then(function (user) {
		var token = _jsonwebtoken2.default.sign({ user: user }, process.env.SECRET_KEY, { expiresIn: '60m' });
		res.status(201).json({
			success: true,
			message: 'Account created successfully',
			id: user.id,
			username: user.username,
			email: user.email,
			token: token
		});
	}).catch(function (err) {
		return res.status(400).json({
			success: false,
			message: err.errors[0].message
		});
	});
};

//The username and password you entered did not match our records. Please double-check and try again.

// Sign in users
var loginUser = exports.loginUser = function loginUser(req, res) {
	var username = req.body.username ? req.body.username.trim() : '';
	var password = req.body.password;

	if (!(username && password)) return res.status(400).json({ success: false, message: 'username and password are required' });

	return User.findOne({
		where: {
			username: req.body.username
		}
	}).then(function (user) {
		var token = _jsonwebtoken2.default.sign({ user: user }, process.env.SECRET_KEY, { expiresIn: '60m' });
		_bcryptjs2.default.compare(password, user.password).then(function (check) {
			if (check) {
				// console.log(req.userId); 
				res.status(200).json({
					success: true,
					message: 'Logged in Successfully!',
					token: token
				});
			} else res.status(401).json({
				success: false,
				message: 'Wrong username and password!'
			});
		}).catch(function (err) {
			return res.status(400).json({
				success: false,
				message: err.errors[0].message });
		});
	});
};

var getUserRecipes = exports.getUserRecipes = function getUserRecipes(req, res) {
	var userId = req.params.userId;
	// console.log(userId);

	Recipe.findAll({
		where: {
			userId: userId
		}
	}).then(function (recipes) {
		var recipesCount = recipes.length;
		// console.log(favorites);
		if (recipesCount == 0) {
			return res.status(200).json({
				success: true,
				message: 'User has no recipes posted'
			});
		}
		return res.status(200).json({ success: true, message: recipesCount + ' recipes posted', recipes: recipes });
	}).catch(function () {
		return res.status(500).json({ success: false, message: 'An error occured! ' });
	});
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsiVXNlciIsIlJlY2lwZSIsImNyZWF0ZVVzZXIiLCJyZXEiLCJyZXMiLCJ1c2VybmFtZSIsImJvZHkiLCJ0cmltIiwiZW1haWwiLCJwYXNzd29yZCIsIkVNQUlMX1JFR0VYUCIsIlVTRVJOQU1FX1JFR0VYUCIsImVycl9tc2ciLCJ0ZXN0IiwibGVuZ3RoIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiY3JlYXRlIiwiaGFzaFN5bmMiLCJmdWxsbmFtZSIsInRoZW4iLCJ0b2tlbiIsInNpZ24iLCJ1c2VyIiwicHJvY2VzcyIsImVudiIsIlNFQ1JFVF9LRVkiLCJleHBpcmVzSW4iLCJpZCIsImNhdGNoIiwiZXJyIiwiZXJyb3JzIiwibG9naW5Vc2VyIiwiZmluZE9uZSIsIndoZXJlIiwiY29tcGFyZSIsImNoZWNrIiwiZ2V0VXNlclJlY2lwZXMiLCJ1c2VySWQiLCJwYXJhbXMiLCJmaW5kQWxsIiwicmVjaXBlc0NvdW50IiwicmVjaXBlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0lBRVFBLEksb0JBQUFBLEk7SUFBTUMsTSxvQkFBQUEsTTs7QUFFZDs7QUFDTyxJQUFNQyxrQ0FBYSxTQUFiQSxVQUFhLENBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFjOztBQUV2QyxLQUFJQyxXQUFXRixJQUFJRyxJQUFKLENBQVNELFFBQVQsR0FBbUJGLElBQUlHLElBQUosQ0FBU0QsUUFBVCxDQUFrQkUsSUFBbEIsRUFBbkIsR0FBNkMsRUFBNUQ7QUFDQSxLQUFJQyxRQUFRTCxJQUFJRyxJQUFKLENBQVNFLEtBQVQsR0FBZ0JMLElBQUlHLElBQUosQ0FBU0UsS0FBVCxDQUFlRCxJQUFmLEVBQWhCLEdBQXVDLEVBQW5EO0FBQ0EsS0FBSUUsV0FBV04sSUFBSUcsSUFBSixDQUFTRyxRQUFULEdBQW9CTixJQUFJRyxJQUFKLENBQVNHLFFBQVQsQ0FBa0JGLElBQWxCLEVBQXBCLEdB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UztBQUZrQixJQUFyQixDQUFQO0FBSUE7QUFDRCxTQUFPZCxJQUFJVyxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsRUFBQ0MsU0FBUyxJQUFWLEVBQWdCQyxTQUFZeUIsWUFBWixvQkFBaEIsRUFBMkRDLGdCQUEzRCxFQUFyQixDQUFQO0FBQ0EsRUFoQkYsRUFpQkViLEtBakJGLENBaUJTO0FBQUEsU0FBTTNCLElBQUlXLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQixFQUFDQyxTQUFTLEtBQVYsRUFBaUJDLFNBQVMsb0JBQTFCLEVBQXJCLENBQU47QUFBQSxFQWpCVDtBQWtCQSxDQXJCTSIsImZpbGUiOiJ1c2VyLmpzIiwic291cmNlUm9vdCI6IkM6L1VzZXJzL1RvYmkvTW9yZS1SZWNpcGVzL3NlcnZlci9jb250cm9sbGVyIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRiIGZyb20gJy4uL21vZGVscyc7XHJcbmltcG9ydCBiY3J5cHRqcyBmcm9tICdiY3J5cHRqcyc7XHJcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcclxuXHJcbmNvbnN0IHsgVXNlciwgUmVjaXBlIH0gPSBkYjtcclxuXHJcbi8vIENyZWF0ZSB1c2Vycy5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZVVzZXIgPSAocmVxLCByZXMpID0+IHtcclxuXHJcblx0bGV0IHVzZXJuYW1lID0gcmVxLmJvZHkudXNlcm5hbWU/IHJlcS5ib2R5LnVzZXJuYW1lLnRyaW0oKTogJyc7IFxyXG5cdGxldCBlbWFpbCA9IHJlcS5ib2R5LmVtYWlsPyByZXEuYm9keS5lbWFpbC50cmltKCk6ICcnO1xyXG5cdGxldCBwYXNzd29yZCA9IHJlcS5ib2R5LnBhc3N3b3JkID8gcmVxLmJvZHkucGFzc3dvcmQudHJpbSgpOiAnJztcclxuXHJcblx0Y29uc3QgRU1BSUxfUkVHRVhQID0gL14oXFx3KSsoXFwuXFx3KykqQChcXHcpKygoXFwuXFx3KykrKSQvO1xyXG5cdGNvbnN0IFVTRVJOQU1FX1JFR0VYUCA9IC9eKFxcdyl7MywxNX0kLztcclxuXHJcblx0bGV0IGVycl9tc2c7XHJcblx0aWYgKHVzZXJuYW1lID09PSAnJyl7XHJcblx0XHRlcnJfbXNnID0gJ1VzZXJuYW1lIGlzIHJlcXVpcmVkJztcclxuXHR9IGVsc2UgaWYgKGVtYWlsID09PSAnJykge1xyXG5cdFx0ZXJyX21zZyA9ICdFbWFpbCBpcyByZXF1aXJlZCc7XHJcblx0fSBlbHNlIGlmICggIVVTRVJOQU1FX1JFR0VYUC50ZXN0KHVzZXJuYW1lKSApIHtcclxuXHRcdGVycl9tc2cgPSAnVXNlcm5hbWUgbXVzdCBiZSBhdGxlYXN0IDMgY2hhcmFjdGVycyBsb25nIGFuZCBhbHBoYW51bWVyaWMnO1xyXG5cdH0gZWxzZSBpZiAoZW1haWwubGVuZ3RoIDw9IDQgfHwgZW1haWwubGVuZ3RoID4gMzAgfHwgIUVNQUlMX1JFR0VYUC50ZXN0KGVtYWlsKSkge1xyXG5cdFx0ZXJyX21zZyA9J2ludmFsaWQgZW1haWwgYWRkcmVzcyc7XHJcblx0fSBlbHNlIGlmIChwYXNzd29yZCA9PT0gJycpIHtcclxuXHRcdGVycl9tc2cgPSAnUGFzc3dvcmQgaXMgcmVxdWlyZWQnO1xyXG5cdH0gZWxzZSBpZiAocGFzc3dvcmQubGVuZ3RoIDwgNikge1xyXG5cdFx0ZXJyX21zZyA9ICdQYXNzd29yZCBtdXN0IGJlIGF0bGVhc3QgNiBjaGFyYWN0ZXJzIGxvbmchJztcclxuXHR9XHJcblxyXG5cdGlmIChlcnJfbXNnKSBcclxuXHRcdHJldHVybiByZXMuc3RhdHVzKDQyMikuanNvbih7c3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycl9tc2d9KTtcclxuXHJcblx0cmV0dXJuIFVzZXJcclxuXHRcdC5jcmVhdGUoe1xyXG5cdFx0XHR1c2VybmFtZTogdXNlcm5hbWUsXHJcblx0XHRcdGVtYWlsOiBlbWFpbCxcclxuXHRcdFx0cGFzc3dvcmQ6IGJjcnlwdGpzLmhhc2hTeW5jKHBhc3N3b3JkLCAxMCksXHJcblx0XHRcdGZ1bGxuYW1lOiByZXEuYm9keS5mdWxsbmFtZVxyXG5cdFx0fSlcclxuXHRcdC50aGVuKHVzZXIgPT4ge1xyXG5cdFx0XHRjb25zdCB0b2tlbiA9IGp3dC5zaWduKHt1c2VyfSwgcHJvY2Vzcy5lbnYuU0VDUkVUX0tFWSwgeyBleHBpcmVzSW46ICc2MG0nfSk7XHJcblx0XHRcdHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuXHRcdFx0XHRzdWNjZXNzOiB0cnVlLFxyXG5cdFx0XHRcdG1lc3NhZ2U6ICdBY2NvdW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcclxuXHRcdFx0XHRpZDogdXNlci5pZCxcclxuXHRcdFx0XHR1c2VybmFtZTogdXNlci51c2VybmFtZSxcclxuXHRcdFx0XHRlbWFpbDogdXNlci5lbWFpbCxcclxuXHRcdFx0XHR0b2tlblxyXG5cdFx0XHR9KTtcclxuXHRcdH0pXHJcblx0XHQuY2F0Y2goZXJyID0+IHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuXHRcdFx0c3VjY2VzczogZmFsc2UsXHJcblx0XHRcdG1lc3NhZ2U6IGVyci5lcnJvcnNbMF0ubWVzc2FnZVxyXG5cdFx0fSkpO1xyXG59O1xyXG5cclxuXHJcbi8vVGhlIHVzZXJuYW1lIGFuZCBwYXNzd29yZCB5b3UgZW50ZXJlZCBkaWQgbm90IG1hdGNoIG91ciByZWNvcmRzLiBQbGVhc2UgZG91YmxlLWNoZWNrIGFuZCB0cnkgYWdhaW4uXHJcblxyXG4vLyBTaWduIGluIHVzZXJzXHJcbmV4cG9ydCBjb25zdCBsb2dpblVzZXIgPSAocmVxLCByZXMpID0+IHtcclxuXHRsZXQgdXNlcm5hbWUgPSByZXEuYm9keS51c2VybmFtZT8gcmVxLmJvZHkudXNlcm5hbWUudHJpbSgpOiAnJzsgXHJcblx0bGV0IHBhc3N3b3JkID0gcmVxLmJvZHkucGFzc3dvcmQ7XHJcblx0XHJcblx0aWYgKCAhKHVzZXJuYW1lICYmIHBhc3N3b3JkKSApIFxyXG5cdFx0cmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTondXNlcm5hbWUgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZCd9KTtcclxuXHJcblx0cmV0dXJuIFVzZXJcclxuXHRcdC5maW5kT25lKHtcclxuXHRcdFx0d2hlcmU6IHsgXHJcblx0XHRcdFx0dXNlcm5hbWU6IHJlcS5ib2R5LnVzZXJuYW1lLFxyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cdFx0LnRoZW4oIHVzZXIgPT4geyBcclxuXHRcdFx0Y29uc3QgdG9rZW4gPSBqd3Quc2lnbih7dXNlcn0sIHByb2Nlc3MuZW52LlNFQ1JFVF9LRVksIHsgZXhwaXJlc0luOiAnNjBtJ30pO1xyXG5cdFx0XHRiY3J5cHRqcy5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKS50aGVuKCBjaGVjayA9PiB7XHJcblx0XHRcdFx0aWYgKGNoZWNrKSB7XHJcblx0XHRcdFx0XHQvLyBjb25zb2xlLmxvZyhyZXEudXNlcklkKTsgXHJcblx0XHRcdFx0XHRyZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcblx0XHRcdFx0XHRcdHN1Y2Nlc3M6IHRydWUsXHJcblx0XHRcdFx0XHRcdG1lc3NhZ2U6ICdMb2dnZWQgaW4gU3VjY2Vzc2Z1bGx5IScsXHJcblx0XHRcdFx0XHRcdHRva2VuXHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9IGVsc2UgcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xyXG5cdFx0XHRcdFx0c3VjY2VzczogZmFsc2UsXHJcblx0XHRcdFx0XHRtZXNzYWdlOiAnV3JvbmcgdXNlcm5hbWUgYW5kIHBhc3N3b3JkISdcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSkuY2F0Y2goZXJyID0+IHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuXHRcdFx0XHRzdWNjZXNzOiBmYWxzZSxcclxuXHRcdFx0XHRtZXNzYWdlOiBlcnIuZXJyb3JzWzBdLm1lc3NhZ2V9KSk7XHJcblx0XHR9KTtcclxufTtcclxuXHJcblxyXG5leHBvcnQgY29uc3QgZ2V0VXNlclJlY2lwZXMgPSAocmVxLCByZXMpID0+IHtcclxuXHRjb25zdCB7IHVzZXJJZCB9ID0gcmVxLnBhcmFtcztcclxuXHQvLyBjb25zb2xlLmxvZyh1c2VySWQpO1xyXG5cdFJlY2lwZVxyXG5cdFx0LmZpbmRBbGwoe1xyXG5cdFx0XHR3aGVyZToge1xyXG5cdFx0XHRcdHVzZXJJZFxyXG5cdFx0XHR9XHJcblx0XHR9KVxyXG5cdFx0LnRoZW4oIHJlY2lwZXMgPT4ge1xyXG5cdFx0XHRjb25zdCByZWNpcGVzQ291bnQgPSAgcmVjaXBlcy5sZW5ndGg7XHJcblx0XHRcdC8vIGNvbnNvbGUubG9nKGZhdm9yaXRlcyk7XHJcblx0XHRcdGlmICggcmVjaXBlc0NvdW50ID09IDAgKSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuXHRcdFx0XHRcdHN1Y2Nlc3M6dHJ1ZSxcclxuXHRcdFx0XHRcdG1lc3NhZ2U6ICdVc2VyIGhhcyBubyByZWNpcGVzIHBvc3RlZCcsXHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBgJHtyZWNpcGVzQ291bnR9IHJlY2lwZXMgcG9zdGVkYCwgcmVjaXBlc30pOyBcclxuXHRcdH0pXHJcblx0XHQuY2F0Y2goICgpID0+IHJlcy5zdGF0dXMoNTAwKS5qc29uKHtzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ0FuIGVycm9yIG9jY3VyZWQhICd9KSk7XHJcbn07Il19